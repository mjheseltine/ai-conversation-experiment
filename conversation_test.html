<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Conversation + AI Summary</title>
<style>
  :root{
    --bg:#f6f7fb; --card:#fff; --muted:#6b7280; --accent:#1f6feb;
    --radius:12px; --shadow:0 6px 18px rgba(35,40,50,0.08);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body{background:var(--bg); margin:24px; color:#111;}
  .container{max-width:820px; margin:0 auto;}
  .conversation{display:flex; flex-direction:column; gap:12px; margin-bottom:16px;}
  .post{
    background:var(--card); border-radius:var(--radius); padding:14px;
    display:flex; gap:12px; box-shadow:var(--shadow); align-items:flex-start;
  }
  .avatar{width:52px; height:52px; border-radius:50%; flex:0 0 52px;
          background:#e6eefc; display:grid; place-items:center; font-weight:700; color:#0b61d6;}
  .content{flex:1;}
  .meta{display:flex; gap:8px; align-items:center; font-size:13px; color:var(--muted);}
  .name{font-weight:600; color:#0f1724;}
  .handle{color:var(--muted);}
  .time{color:var(--muted);}
  .text{margin-top:8px; font-size:15px; line-height:1.45; color:#0f1724;}
  .actions{margin-top:12px; display:flex; gap:10px; color:var(--muted); font-size:13px;}
  .reply-box { margin-top:12px; display:flex; gap:10px; }
  textarea{flex:1; min-height:78px; padding:10px; border-radius:10px; border:1px solid #e6edf7; resize:vertical; font-size:14px; }
  .submit{background:var(--accent); color:white; border:none; padding:8px 14px; border-radius:8px; cursor:pointer;}
  .ai-summary-btn{
    display:inline-block; margin-top:12px; background:var(--accent);
    color:white; padding:10px 18px; border:none; border-radius:10px;
    cursor:pointer; font-weight:600; font-size:15px;
  }
  .ai-summary-box{
    background:#fffbea; color:#1f2937; border:1px solid #facc15;
    border-radius:var(--radius); padding:14px 16px; margin-top:14px;
    display:none; box-shadow:var(--shadow);
  }
</style>
</head>
<body>
  <div class="container" role="main">
    <h2>Conversation Preview</h2>
    <div id="conversation" class="conversation"></div>

    <button id="aiSummaryBtn" class="ai-summary-btn">üí¨ View AI Summary</button>
    <div id="aiSummaryBox" class="ai-summary-box">
      <strong>AI Summary:</strong>
      <span id="summaryText">This is where an AI-generated summary of the discussion will appear.</span>
    </div>

    <div style="margin-top:18px;">
      <label for="userComment" style="display:block;margin-bottom:8px;font-weight:600">Your comment</label>
      <div class="reply-box">
        <textarea id="userComment" placeholder="Write a reply..."></textarea>
        <button id="submitComment" class="submit">Post comment</button>
      </div>
    </div>
  </div>

<script>
/* -----------------------------
   Conversation Data
----------------------------- */
const posts = [
  {
    id: "p1",
    avatarLabel: "A",
    name: "Taylor Brooks",
    handle: "@taylor_b",
    time: "2h",
    text: "Raising the minimum wage to $15 would give millions more financial breathing room and stimulate local economies. It's time to act."
  },
  {
    id: "p2",
    avatarLabel: "J",
    name: "Jordan Lee",
    handle: "@jordanlee",
    time: "1h",
    text: "That sounds good in theory, but many small businesses can't absorb those costs. We should consider targeted tax credits instead of a blanket increase."
  }
];

/* -----------------------------
   Helper Functions
----------------------------- */
function renderConversation(containerId, postsArray){
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  postsArray.forEach(p => {
    const post = document.createElement("article");
    post.className = "post";
    post.setAttribute("data-post-id", p.id);
    post.innerHTML = `
      <div class="avatar">${escapeHtml(initials(p.avatarLabel || p.name))}</div>
      <div class="content">
        <div class="meta">
          <div class="name">${escapeHtml(p.name)}</div>
          <div class="handle">${escapeHtml(p.handle)}</div>
          <div class="time">¬∑ ${escapeHtml(p.time)}</div>
        </div>
        <div class="text">${escapeHtml(p.text)}</div>
        <div class="actions">
          <div>üí¨ Reply</div>
          <div>üîÅ Share</div>
          <div>‚ù§Ô∏è Like</div>
        </div>
      </div>
    `;
    container.appendChild(post);
  });
}

function initials(label){
  const toks = label.trim().split(/\s+/);
  return toks.length>1 ? (toks[0][0]+toks[1][0]).toUpperCase() : label.slice(0,2).toUpperCase();
}

function escapeHtml(text){
  return String(text)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#039;');
}

/* -----------------------------
   Render Initial Conversation
----------------------------- */
renderConversation("conversation", posts);

/* -----------------------------
   AI Summary Button Logic
----------------------------- */
const aiBtn = document.getElementById("aiSummaryBtn");
const aiBox = document.getElementById("aiSummaryBox");
const summaryText = document.getElementById("summaryText");
let shown = false;

aiBtn.addEventListener("click", () => {
  shown = !shown;
  aiBox.style.display = shown ? "block" : "none";
  aiBtn.textContent = shown ? "üîΩ Hide AI Summary" : "üí¨ View AI Summary";

  if(shown){
    summaryText.textContent =
      "One user emphasizes higher wages as economic relief, while another raises concerns about small business sustainability.";

    // Record that AI Summary was clicked in Qualtrics
    if(typeof Qualtrics !== "undefined" && Qualtrics.SurveyEngine){
      Qualtrics.SurveyEngine.setEmbeddedData('AI_Clicked','1');
    }
  }
});

/* -----------------------------
   Capture User Comment
----------------------------- */
document.getElementById("submitComment").addEventListener("click", () => {
  const txt = document.getElementById("userComment").value.trim();
  if(!txt){ alert("Please write something before posting."); return; }

  // Add new post locally
  const newPost = {
    id: "u"+Date.now(),
    avatarLabel: "Y",
    name: "You",
    handle: "@you",
    time: "now",
    text: txt
  };
  posts.push(newPost);
  renderConversation("conversation", posts);

  // Clear textarea
  document.getElementById("userComment").value = "";

  // Record comment in Qualtrics
  if(typeof Qualtrics !== "undefined" && Qualtrics.SurveyEngine){
    Qualtrics.SurveyEngine.setEmbeddedData('User_Comment', txt);
  }
});
</script>
</body>
</html>
