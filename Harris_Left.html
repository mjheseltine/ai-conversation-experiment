<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kamala Conversation</title>

<style>
  :root {
    --bg:#f6f7fb; --card:#fff; --muted:#6b7280; --accent:#1f6feb;
    --radius:12px; --shadow:0 6px 18px rgba(35,40,50,0.08);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body { background:var(--bg); margin:20px; color:#111; }
  .container { max-width:820px; margin:0 auto; }

  .conversation { display:flex; flex-direction:column; gap:12px; margin-bottom:12px; }

  .post {
    background:var(--card); border-radius:var(--radius); padding:12px;
    display:flex; gap:12px; align-items:flex-start; box-shadow:var(--shadow);
    border-bottom:1px solid #f1f5f9; position:relative;
  }
  .post:hover { transform:translateY(-2px); transition:transform .15s ease; }

  .ai-summary {
    background:#fffdf8;
    border:1px solid #fbe5b3;
    border-radius:var(--radius);
    padding:12px;
    display:flex;
    gap:12px;
    align-items:flex-start;
    box-shadow:var(--shadow);
  }
  .ai-summary:hover { transform:translateY(-2px); transition:transform .15s ease; }

  .avatar { width:48px; height:48px; border-radius:50%; display:grid; place-items:center; color:#fff; font-weight:700; font-size:14px; }
  .g1{background:linear-gradient(135deg,#1f6feb,#3b82f6);}
  .g2{background:linear-gradient(135deg,#10b981,#34d399);}
  .g3{background:linear-gradient(135deg,#f59e0b,#fbbf24);}
  .g4{background:linear-gradient(135deg,#ec4899,#f472b6);}
  .g-ai { background:linear-gradient(135deg,#6366f1,#8b5cf6); }

  .content{flex:1;}
  .meta{display:flex;gap:8px;align-items:center;font-size:13px;color:var(--muted);}
  .name{font-weight:700;color:#0f1724;margin-right:4px;}
  .handle{color:var(--muted);}
  .text{margin-top:6px;font-size:15px;line-height:1.45;color:#0f1724;white-space:pre-wrap;}

  .actions{margin-top:10px;display:flex;gap:14px;color:var(--muted);font-size:13px;}
  .actions button{background:none;border:none;cursor:pointer;padding:4px 6px;border-radius:6px;}
  .actions button:hover{background:#f1f5f9;transform:scale(1.08);}

  #showMore{display:block;margin:8px auto 12px auto;padding:8px 14px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer;font-weight:500;}
  #showMore.fade-out{animation:fadeOut .25s forwards;}

  .fade-in{animation:fadeInUp .36s ease forwards;}
  @keyframes fadeInUp{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:none;}}
  @keyframes fadeOut{from{opacity:1;}to{opacity:0;transform:scale(.98);}}

  .reply-box{margin-top:12px;display:flex;gap:10px;align-items:flex-end;}
  textarea{flex:1;min-height:78px;padding:10px;border-radius:8px;border:1px solid #e2e8f0;font-size:14px;resize:vertical;}
  .post-btn{padding:8px 14px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer;}
  .post-btn:hover{background:#155bd8;}

  /* Highlight for the main post */
  .main-post-highlight {
      background-color: #e8f3ff;
      border: 1px solid #d0e7ff;
  }
</style>
</head>

<body>
<div class="container">
  <h2>Conversation - Please Read, React, and Respond</h2>

  <div id="conversation" class="conversation" aria-live="polite"></div>

  <button id="showMore">Show more comments</button>

  <div class="reply-box">
    <textarea id="userComment" placeholder="Write a reply..."></textarea>
    <button id="postComment" class="post-btn">Post</button>
  </div>
</div>

<script>
/* ---------------------------------------------------
   POST DATA
---------------------------------------------------- */

const initialPosts = [
  {
    id: "p1",
    name: "PoliticsDaily",
    handle: "@pol_daily",
    avatarSeed: "PD",
    text: "NEWS: Kamala Harris is hitting the campaign trail with a surprise event for State Rep. Aftyn Behn, the Democrat running in the TN-7 special election. This is Kamala Harris‚Äôs first surrogate event for another Democrat since leaving office ‚Äî in a seat Trump carried by 22 points a year ago",
    likes: 92,
    retweets: 18
  },
  {
    id: "p2",
    name: "TruthGuard",
    handle: "@truthguard",
    avatarSeed: "TG",
    text: "Kamala Harris doesn't jump in like this without a strategic reason, so showing up for Behn signals the Dems see an opening and want to push harder in the final stretch.",
    likes: 33,
    retweets: 4
  },
  {
    id: "p3",
    name: "Justice4All",
    handle: "@justice_watch",
    avatarSeed: "JW",
    text: "The Democrats in TN have been trying to dissociate themselves from the extreme leftward drift of their national party in an attempt to regain some electoral power. Nominating Behn, and now tripling down with Jasmine Crockett & Kamala Harris is a puzzling tactic if that is indeed the TNDP strategy.",
    likes: 41,
    retweets: 9
  },
  {
    id: "p4",
    name: "Watcher",
    handle: "@watcher",
    avatarSeed: "WA",
    text: "That's amazing üòç",
    likes: 18,
    retweets: 2
  },
  {
    id: "p5",
    name: "Ella",
    handle: "@ella_az",
    avatarSeed: "EA",
    text: "Poor political instincts here. Kamala will likely drive up Republican turnout.",
    likes: 22,
    retweets: 1
  }
];


const morePosts = [
  {
    id: "p6",
    name: "DylanZ",
    handle: "@dz_reads",
    avatarSeed: "DZ",
    text: "LMFAOOOO Well, congrats to representative elect Matt Van Epps‚Ä¶",
    likes: 19,
    retweets: 1
  },
  {
    id: "p7",
    name: "MayaH",
    handle: "@mayah_ideas",
    avatarSeed: "MH",
    text: "Horrible move. I don‚Äôt think ppl realize how unlikable Kamala is",
    likes: 27,
    retweets: 5
  },
  {
    id: "p8",
    name: "Janelle",
    handle: "@janelle_d",
    avatarSeed: "JD",
    text: "This is an early vote turnout event at an HBCU in the district. They need to maximize black (especially young black) turnout to have a shot. They must think the risk is worth the potential reward. Whether their gamble pays off, we'll see.",
    likes: 20,
    retweets: 2
  },
  {
    id: "p9",
    name: "Avery",
    handle: "@averylane",
    avatarSeed: "AL",
    text: "They have turnout in North Nashville that‚Äôs where she was, Hadley Park to be exact. Meanwhile Van Epps refuses to talk to anyone in Nashville",
    likes: 24,
    retweets: 3
  },
];

const aiSummary = {
  id: "ai_summary",
  isAi: true,
  name: "AI Assistant ü§ñ",
  avatarSeed: "AI",
  text: "Let me provide some context on this: Kamala Harris making crucial first post-VP appearance for Aftyn Behn in TN-7 special election shows Democrats are fighting everywhere, even in tough territory. This is smart strategy‚Äîthe event at an HBCU in North Nashville targets maximizing Black and young voter turnout in areas where Dems can actually win. Meanwhile, Republican Van Epps refuses to even talk to Nashville voters, showing the contrast. Harris doesn't show up without seeing a real opening, and energizing the base in early voting could flip this race. Even if it's an uphill battle, Democrats aren't conceding red districts without a fight.üó≥Ô∏è"
};
  
/* ---------------------------------------------------
   RANDOMIZATION HELPERS
---------------------------------------------------- */

function shuffle(arr) {
  let a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function initials(seed) {
  const s = String(seed).trim().split(/\s+/);
  return s.length > 1 ? s[0][0] + s[1][0] : String(seed).slice(0, 2).toUpperCase();
}

function seedToAvatarClass(seed) {
  let s = 0;
  for (let c of String(seed)) s += c.charCodeAt(0);
  return ["g1", "g2", "g3", "g4"][s % 4];
}

let appendedMore = false;
let likeCounts = {};
let retweetCounts = {};

const convo = document.getElementById("conversation");

/* ---------------------------------------------------
   RENDER INITIAL (with AI + randomization + highlight)
---------------------------------------------------- */

function renderInitial() {
  convo.innerHTML = "";

  const first = initialPosts[0];
  const remaining = shuffle(initialPosts.slice(1));

  // Create main post and apply highlight
  const firstEl = createPost(first);
  firstEl.classList.add("main-post-highlight");
  convo.appendChild(firstEl);

  // AI summary stays second
  convo.appendChild(createAiSummaryElement(aiSummary));

  // Remaining posts randomized
  remaining.forEach(p => convo.appendChild(createPost(p)));
}

/* ---------------------------------------------------
   POST ELEMENTS
---------------------------------------------------- */

function createPost(p) {
  const wrap = document.createElement("article");
  wrap.className = "post fade-in";
  wrap.id = `post-${p.id}`;

  const av = document.createElement("div");
  av.className = "avatar " + seedToAvatarClass(p.avatarSeed || p.name || p.id);
  av.textContent = initials(p.avatarSeed || p.name || p.id);

  const cont = document.createElement("div");
  cont.className = "content";

  const meta = document.createElement("div");
  meta.className = "meta";
  const nm = document.createElement("span");
  nm.className = "name";
  nm.textContent = p.name;
  const hd = document.createElement("span");
  hd.className = "handle";
  hd.textContent = " " + p.handle;
  meta.append(nm, hd);

  const txt = document.createElement("div");
  txt.className = "text";
  txt.textContent = p.text;

  const act = document.createElement("div");
  act.className = "actions";

  const like = document.createElement("button");
  like.innerHTML = `‚ù§Ô∏è <span class="count">${p.likes || 0}</span>`;
  like.onclick = () => {
    likeCounts[p.id] = (likeCounts[p.id] ?? p.likes ?? 0) + 1;
    like.querySelector(".count").textContent = likeCounts[p.id];
    window.parent.postMessage({ type: "USER_LIKE", postId: p.id }, "*");
  };

  const rt = document.createElement("button");
  rt.innerHTML = `üîÅ <span class="count">${p.retweets || 0}</span>`;
  rt.onclick = () => {
    retweetCounts[p.id] = (retweetCounts[p.id] ?? p.retweets ?? 0) + 1;
    rt.querySelector(".count").textContent = retweetCounts[p.id];
    window.parent.postMessage({ type: "USER_RETWEET", postId: p.id }, "*");
  };

  act.append(like, rt);
  cont.append(meta, txt, act);
  wrap.append(av, cont);

  addHoverTracking(wrap, p.id);
  return wrap;
}

/* -------------------------
   AI SUMMARY WITH ACTIONS
-------------------------- */

function createAiSummaryElement(ai) {
  const el = document.createElement("div");
  el.className = "ai-summary fade-in";
  el.id = "ai-summary";

  const avatar = document.createElement("div");
  avatar.className = "avatar g-ai";
  avatar.textContent = "ü§ñ";

  const content = document.createElement("div");
  content.className = "content";

  const meta = document.createElement("div");
  meta.className = "meta";

  const name = document.createElement("span");
  name.className = "name";
  name.textContent = ai.name;

  meta.appendChild(name);

  const text = document.createElement("div");
  text.className = "text";
  text.textContent = ai.text;

  const actions = document.createElement("div");
  actions.className = "actions";

  const likeBtn = document.createElement("button");
  likeBtn.innerHTML = `‚ù§Ô∏è <span class="count">${ai.likes}</span>`;
  likeBtn.onclick = () => {
    ai.likes++;
    likeBtn.querySelector(".count").textContent = ai.likes;
    window.parent.postMessage({ type: "USER_LIKE", postId: ai.id }, "*");
  };

  const rtBtn = document.createElement("button");
  rtBtn.innerHTML = `üîÅ <span class="count">${ai.retweets}</span>`;
  rtBtn.onclick = () => {
    ai.retweets++;
    rtBtn.querySelector(".count").textContent = ai.retweets;
    window.parent.postMessage({ type: "USER_RETWEET", postId: ai.id }, "*");
  };

  actions.append(likeBtn, rtBtn);

  content.append(meta, text, actions);
  el.append(avatar, content);

  addHoverTracking(el, ai.id);
  return el;
}

/* ---------------------------------------------------
   HOVER TRACKING
---------------------------------------------------- */

function addHoverTracking(el, postId) {
  let timer;
  el.addEventListener("mouseenter", () => {
    timer = setTimeout(() =>
      window.parent.postMessage({ type: "USER_HOVER_POST", postId }, "*"),
    2000);
  });
  el.addEventListener("mouseleave", () => clearTimeout(timer));
}

/* ---------------------------------------------------
   SHOW MORE (randomized)
---------------------------------------------------- */

document.getElementById("showMore").onclick = e => {
  if (appendedMore) return;
  appendedMore = true;

  shuffle(morePosts).forEach(p =>
    convo.appendChild(createPost(p))
  );

  e.target.classList.add("fade-out");
  setTimeout(() => (e.target.style.display = "none"), 260);

  window.parent.postMessage({ type: "USER_SHOW_MORE_CLICKED" }, "*");
  sendHeight();
};

/* ---------------------------------------------------
   USER COMMENT
---------------------------------------------------- */

document.getElementById("postComment").onclick = () => {
  const ta = document.getElementById("userComment");
  const txt = ta.value.trim();
  if (!txt) return alert("Please write something before posting.");

  const newPost = {
    id: "u" + Date.now(),
    name: "You",
    handle: "@you",
    avatarSeed: "YOU",
    text: txt,
    likes: 0,
    retweets: 0
  };

  convo.appendChild(createPost(newPost));
  ta.value = "";

  window.parent.postMessage({ type: "USER_COMMENT", data: txt }, "*");
  sendHeight();
};

/* ---------------------------------------------------
   HEIGHT REPORTING FOR QUALTRICS
---------------------------------------------------- */

function sendHeight() {
  if (window.parent !== window) {
    window.parent.postMessage(
      { type: "IFRAME_HEIGHT", height: document.body.scrollHeight },
      "*"
    );
  }
}

/* ---------------------------------------------------
   INIT
---------------------------------------------------- */

renderInitial();
sendHeight();

new MutationObserver(sendHeight).observe(convo, {
  childList: true,
  subtree: true
});
</script>

</body>
</html>
