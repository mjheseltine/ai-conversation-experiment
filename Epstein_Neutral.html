<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Epstein Conversation</title>

<style>
  :root {
    --bg:#f6f7fb; --card:#fff; --muted:#6b7280; --accent:#1f6feb;
    --radius:12px; --shadow:0 6px 18px rgba(35,40,50,0.08);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body { background:var(--bg); margin:20px; color:#111; }
  .container { max-width:820px; margin:0 auto; }

  .conversation { display:flex; flex-direction:column; gap:12px; margin-bottom:12px; }

  .post {
    background:var(--card); border-radius:var(--radius); padding:12px;
    display:flex; gap:12px; align-items:flex-start; box-shadow:var(--shadow);
    border-bottom:1px solid #f1f5f9; position:relative;
  }
  .post:hover { transform:translateY(-2px); transition:transform .15s ease; }

  .ai-summary {
    background:#fffdf8;
    border:1px solid #fbe5b3;
    border-radius:var(--radius);
    padding:12px;
    display:flex;
    gap:12px;
    align-items:flex-start;
    box-shadow:var(--shadow);
  }
  .ai-summary:hover { transform:translateY(-2px); transition:transform .15s ease; }

  .avatar { width:48px; height:48px; border-radius:50%; display:grid; place-items:center; color:#fff; font-weight:700; font-size:14px; }
  .g1{background:linear-gradient(135deg,#1f6feb,#3b82f6);}
  .g2{background:linear-gradient(135deg,#10b981,#34d399);}
  .g3{background:linear-gradient(135deg,#f59e0b,#fbbf24);}
  .g4{background:linear-gradient(135deg,#ec4899,#f472b6);}
  .g-ai { background:linear-gradient(135deg,#6366f1,#8b5cf6); }

  .content{flex:1;}
  .meta{display:flex;gap:8px;align-items:center;font-size:13px;color:var(--muted);}
  .name{font-weight:700;color:#0f1724;margin-right:4px;}
  .handle{color:var(--muted);}
  .text{margin-top:6px;font-size:15px;line-height:1.45;color:#0f1724;white-space:pre-wrap;}

  .actions{margin-top:10px;display:flex;gap:14px;color:var(--muted);font-size:13px;}
  .actions button{background:none;border:none;cursor:pointer;padding:4px 6px;border-radius:6px;}
  .actions button:hover{background:#f1f5f9;transform:scale(1.08);}

  #showMore{display:block;margin:8px auto 12px auto;padding:8px 14px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer;font-weight:500;}
  #showMore.fade-out{animation:fadeOut .25s forwards;}

  .fade-in{animation:fadeInUp .36s ease forwards;}
  @keyframes fadeInUp{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:none;}}
  @keyframes fadeOut{from{opacity:1;}to{opacity:0;transform:scale(.98);}}

  .reply-box{margin-top:12px;display:flex;gap:10px;align-items:flex-end;}
  textarea{flex:1;min-height:78px;padding:10px;border-radius:8px;border:1px solid #e2e8f0;font-size:14px;resize:vertical;}
  .post-btn{padding:8px 14px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer;}
  .post-btn:hover{background:#155bd8;}
</style>
</head>

<body>
<div class="container">
  <h2>Conversation</h2>

  <div id="conversation" class="conversation" aria-live="polite"></div>

  <button id="showMore">Show more comments</button>

  <div class="reply-box">
    <textarea id="userComment" placeholder="Write a reply..."></textarea>
    <button id="postComment" class="post-btn">Post</button>
  </div>
</div>

<script>
/* ---------------------------------------------------
   POST DATA
---------------------------------------------------- */

const initialPosts = [
  {
    id: "p1",
    name: "PoliticsDaily",
    handle: "@pol_daily",
    avatarSeed: "PD",
    text: "NEWS: President Donald Trump said that he has signed a bill directing the Justice Department to release the Epstein files, documents fervently sought by his political opponents and members of his political base.",
    likes: 92,
    retweets: 18
  },
  {
    id: "p2",
    name: "TruthGuard",
    handle: "@truthguard",
    avatarSeed: "TG",
    text: "This is another fabricated smear. Democrats are desperate to drag Trump back into this mess.",
    likes: 33,
    retweets: 4
  },
  {
    id: "p3",
    name: "Justice4All",
    handle: "@justice_watch",
    avatarSeed: "JW",
    text: "Trump, Bondi, Patel, Johnson ‚Äî all of them know Trump cannot survive the full release of the Epstein files. The coverup started with Epstein‚Äôs sweetheart deal and it‚Äôs still going.",
    likes: 41,
    retweets: 9
  },
  {
    id: "p4",
    name: "Watcher",
    handle: "@watcher",
    avatarSeed: "WA",
    text: "Oh boy. This is either going to blow up or disappear like everything else tied to Epstein.",
    likes: 18,
    retweets: 2
  },
  {
    id: "p5",
    name: "Ella",
    handle: "@ella_az",
    avatarSeed: "EA",
    text: "Important question: If these emails were so damning, why are they surfacing now?",
    likes: 22,
    retweets: 1
  }
];

const morePosts = [
  {
    id: "p6",
    name: "DylanZ",
    handle: "@dz_reads",
    avatarSeed: "DZ",
    text: "Everyone is assuming guilt or innocence based on their political team. The evidence should speak for itself, not party loyalty.",
    likes: 19,
    retweets: 1
  },
  {
    id: "p7",
    name: "MayaH",
    handle: "@mayah_ideas",
    avatarSeed: "MH",
    text: "Whether you like Trump or not, victims deserve transparency. Release *all* the files ‚Äî no redactions.",
    likes: 27,
    retweets: 5
  },
  {
    id: "p8",
    name: "Janelle",
    handle: "@janelle_d",
    avatarSeed: "JD",
    text: "Hard to trust anything when the justice system let Epstein operate for decades. It‚Äôs not just a Trump problem ‚Äî it‚Äôs systemic.",
    likes: 20,
    retweets: 2
  },
  {
    id: "p9",
    name: "Avery",
    handle: "@averylane",
    avatarSeed: "AL",
    text: "What matters is whether these files show coordination, awareness, or just name-dropping. Context matters.",
    likes: 24,
    retweets: 3
  }
];

/* ---- AI SUMMARY ---- */
const aiSummary = {
  id: "ai_summary",
  name: "AI Summary ü§ñ",
  avatarSeed: "AI",
  text: "Senate unanimously votes to compel DOJ release of additional Epstein files after House approval‚Äîbill heads to Trump for signature. Bipartisan push for transparency comes amid ongoing interest in Epstein's connections across political, business, and social elite circles. Key questions remain about scope of release, potential redactions, and whether documents provide meaningful accountability or fuel partisan narratives. Outcome will test commitment to full disclosure. üîçüìÑ",
  likes: 11,
  retweets: 5
};

/* ---------------------------------------------------
   RANDOMIZATION HELPERS
---------------------------------------------------- */

function shuffle(arr) {
  let a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function initials(seed) {
  const s = String(seed).trim().split(/\s+/);
  return s.length > 1 ? s[0][0] + s[1][0] : String(seed).slice(0, 2).toUpperCase();
}

function seedToAvatarClass(seed) {
  let s = 0;
  for (let c of String(seed)) s += c.charCodeAt(0);
  return ["g1", "g2", "g3", "g4"][s % 4];
}

let appendedMore = false;
let likeCounts = {};
let retweetCounts = {};

const convo = document.getElementById("conversation");

/* ---------------------------------------------------
   RENDER INITIAL (with AI + randomization)
---------------------------------------------------- */

function renderInitial() {
  convo.innerHTML = "";

  const first = initialPosts[0];
  const remaining = shuffle(initialPosts.slice(1));

  convo.appendChild(createPost(first));
  convo.appendChild(createAiSummaryElement(aiSummary));
  remaining.forEach(p => convo.appendChild(createPost(p)));
}

/* ---------------------------------------------------
   POST ELEMENTS
---------------------------------------------------- */

function createPost(p) {
  const wrap = document.createElement("article");
  wrap.className = "post fade-in";
  wrap.id = `post-${p.id}`;

  const av = document.createElement("div");
  av.className = "avatar " + seedToAvatarClass(p.avatarSeed || p.name || p.id);
  av.textContent = initials(p.avatarSeed || p.name || p.id);

  const cont = document.createElement("div");
  cont.className = "content";

  const meta = document.createElement("div");
  meta.className = "meta";
  const nm = document.createElement("span");
  nm.className = "name";
  nm.textContent = p.name;
  const hd = document.createElement("span");
  hd.className = "handle";
  hd.textContent = " " + p.handle;
  meta.append(nm, hd);

  const txt = document.createElement("div");
  txt.className = "text";
  txt.textContent = p.text;

  const act = document.createElement("div");
  act.className = "actions";

  const like = document.createElement("button");
  like.innerHTML = `‚ù§Ô∏è <span class="count">${p.likes || 0}</span>`;
  like.onclick = () => {
    likeCounts[p.id] = (likeCounts[p.id] ?? p.likes ?? 0) + 1;
    like.querySelector(".count").textContent = likeCounts[p.id];
    window.parent.postMessage({ type: "USER_LIKE", postId: p.id }, "*");
  };

  const rt = document.createElement("button");
  rt.innerHTML = `üîÅ <span class="count">${p.retweets || 0}</span>`;
  rt.onclick = () => {
    retweetCounts[p.id] = (retweetCounts[p.id] ?? p.retweets ?? 0) + 1;
    rt.querySelector(".count").textContent = retweetCounts[p.id];
    window.parent.postMessage({ type: "USER_RETWEET", postId: p.id }, "*");
  };

  act.append(like, rt);
  cont.append(meta, txt, act);
  wrap.append(av, cont);

  addHoverTracking(wrap, p.id);
  return wrap;
}

/* -------------------------
   AI SUMMARY WITH ACTIONS
-------------------------- */

function createAiSummaryElement(ai) {
  const el = document.createElement("div");
  el.className = "ai-summary fade-in";
  el.id = "ai-summary";

  const avatar = document.createElement("div");
  avatar.className = "avatar g-ai";
  avatar.textContent = "ü§ñ";

  const content = document.createElement("div");
  content.className = "content";

  const meta = document.createElement("div");
  meta.className = "meta";

  const name = document.createElement("span");
  name.className = "name";
  name.textContent = ai.name;

  meta.appendChild(name);

  const text = document.createElement("div");
  text.className = "text";
  text.textContent = ai.text;

  const actions = document.createElement("div");
  actions.className = "actions";

  const likeBtn = document.createElement("button");
  likeBtn.innerHTML = `‚ù§Ô∏è <span class="count">${ai.likes}</span>`;
  likeBtn.onclick = () => {
    ai.likes++;
    likeBtn.querySelector(".count").textContent = ai.likes;
    window.parent.postMessage({ type: "USER_LIKE", postId: ai.id }, "*");
  };

  const rtBtn = document.createElement("button");
  rtBtn.innerHTML = `üîÅ <span class="count">${ai.retweets}</span>`;
  rtBtn.onclick = () => {
    ai.retweets++;
    rtBtn.querySelector(".count").textContent = ai.retweets;
    window.parent.postMessage({ type: "USER_RETWEET", postId: ai.id }, "*");
  };

  actions.append(likeBtn, rtBtn);

  content.append(meta, text, actions);
  el.append(avatar, content);

  addHoverTracking(el, ai.id);
  return el;
}

/* ---------------------------------------------------
   HOVER TRACKING
---------------------------------------------------- */

function addHoverTracking(el, postId) {
  let timer;
  el.addEventListener("mouseenter", () => {
    timer = setTimeout(() =>
      window.parent.postMessage({ type: "USER_HOVER_POST", postId }, "*"),
    2000);
  });
  el.addEventListener("mouseleave", () => clearTimeout(timer));
}

/* ---------------------------------------------------
   SHOW MORE (randomized)
---------------------------------------------------- */

document.getElementById("showMore").onclick = e => {
  if (appendedMore) return;
  appendedMore = true;

  shuffle(morePosts).forEach(p =>
    convo.appendChild(createPost(p))
  );

  e.target.classList.add("fade-out");
  setTimeout(() => (e.target.style.display = "none"), 260);

  window.parent.postMessage({ type: "USER_SHOW_MORE_CLICKED" }, "*");
  sendHeight();
};

/* ---------------------------------------------------
   USER COMMENT
---------------------------------------------------- */

document.getElementById("postComment").onclick = () => {
  const ta = document.getElementById("userComment");
  const txt = ta.value.trim();
  if (!txt) return alert("Please write something before posting.");

  const newPost = {
    id: "u" + Date.now(),
    name: "You",
    handle: "@you",
    avatarSeed: "YOU",
    text: txt,
    likes: 0,
    retweets: 0
  };

  convo.appendChild(createPost(newPost));
  ta.value = "";

  window.parent.postMessage({ type: "USER_COMMENT", data: txt }, "*");
  sendHeight();
};

/* ---------------------------------------------------
   HEIGHT REPORTING FOR QUALTRICS
---------------------------------------------------- */

function sendHeight() {
  if (window.parent !== window) {
    window.parent.postMessage(
      { type: "IFRAME_HEIGHT", height: document.body.scrollHeight },
      "*"
    );
  }
}

/* ---------------------------------------------------
   INIT
---------------------------------------------------- */

renderInitial();
sendHeight();

new MutationObserver(sendHeight).observe(convo, {
  childList: true,
  subtree: true
});
</script>

</body>
</html>
