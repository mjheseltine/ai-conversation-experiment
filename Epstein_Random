<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Government Shutdown Conversation with AI Summary</title>

<style>
  :root {
    --bg: #f6f7fb;
    --card: #fff;
    --muted: #6b7280;
    --accent: #1f6feb;
    --radius: 12px;
    --shadow: 0 6px 18px rgba(35, 40, 50, 0.08);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body { background: var(--bg); margin: 20px; color: #111; }
  .container { max-width: 820px; margin: 0 auto; }
  .conversation { display: flex; flex-direction: column; gap: 12px; margin-bottom: 12px; }
  .post {
    background: var(--card);
    border-radius: var(--radius);
    padding: 12px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
    box-shadow: var(--shadow);
    border-bottom: 1px solid #f1f5f9;
    position: relative;
  }
  .post::after {
    content: "";
    position: absolute;
    bottom: -1px;
    left: 72px;
    right: 12px;
    height: 1px;
    background: rgba(0,0,0,0.05);
  }
  .post:hover { transform: translateY(-2px); transition: transform 0.15s ease; }
  .avatar { width: 48px; height: 48px; border-radius: 50%; flex: 0 0 48px; display: grid; place-items: center; color: #fff; font-weight: 700; font-size: 14px; }
  .g1 { background: linear-gradient(135deg,#1f6feb,#3b82f6); }
  .g2 { background: linear-gradient(135deg,#10b981,#34d399); }
  .g3 { background: linear-gradient(135deg,#f59e0b,#fbbf24); }
  .g4 { background: linear-gradient(135deg,#ec4899,#f472b6); }
  .g-ai { background: linear-gradient(135deg,#6366f1,#8b5cf6); }
  .content { flex: 1; }
  .meta { display: flex; gap: 8px; align-items: center; font-size: 13px; color: var(--muted); }
  .name { font-weight: 700; color: #0f1724; margin-right: 4px; }
  .handle { color: var(--muted); }
  .text { margin-top: 6px; font-size: 15px; line-height: 1.45; color: #0f1724; white-space: pre-wrap; }
  .actions { margin-top: 10px; display: flex; gap: 14px; color: var(--muted); font-size: 13px; }
  .actions button { background: none; border: none; cursor: pointer; padding: 4px 6px; border-radius: 6px; }
  .actions button:hover { background: #f1f5f9; transform: scale(1.08); }
  .ai-summary { display: flex; gap: 10px; align-items: flex-start; background: #fffdf8; border: 1px solid #fbe5b3; padding: 12px; border-radius: 10px; box-shadow: var(--shadow); }

  #showMore { display: block; margin: 8px auto 12px auto; padding: 8px 14px; border-radius: 8px; border: none; background: var(--accent); color: #fff; cursor: pointer; font-weight: 500; }
  #showMore.fade-out { animation: fadeOut .25s forwards; }

  .fade-in { animation: fadeInUp .36s ease forwards; }
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }
  @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; transform: scale(.98); } }

  .reply-box { margin-top: 12px; display: flex; gap: 10px; align-items: flex-end; }
  textarea { flex: 1; min-height: 78px; padding: 10px; border-radius: 8px; border: 1px solid #e2e8f0; font-size: 14px; resize: vertical; }
  .post-btn { padding: 8px 14px; border-radius: 8px; border: none; background: var(--accent); color: #fff; cursor: pointer; }
  .post-btn:hover { background: #155bd8; }
</style>
</head>

<body>
<div class="container">
  <h2>Conversation</h2>

  <div id="conversation" class="conversation" aria-live="polite"></div>

  <button id="showMore">Show more comments</button>

  <div class="reply-box">
    <textarea id="userComment" placeholder="Write a reply..."></textarea>
    <button id="postComment" class="post-btn">Post</button>
  </div>
</div>

<script>
/* ---------------------------------------------------
   POST DATA (You will replace these for each variant)
---------------------------------------------------- */

const initialPosts = [
  {
    id: "p1",
    name: "PoliticsDaily",
    handle: "@pol_daily",
    avatarSeed: "PD",
    text: "NEWS: The Senate has unanimously voted to force the Justice Department to release more Epstein files ‚Äî acting hours after an overwhelming House vote to send the bill to Trump's desk.",
    likes: 92,
    retweets: 18
  },
  {
    id: "p2",
    name: "TruthGuard",
    handle: "@truthguard",
    avatarSeed: "TG",
    text: "This is another fabricated smear. Democrats are desperate to drag Trump back into this mess.",
    likes: 33,
    retweets: 4
  },
  {
    id: "p3",
    name: "Justice4All",
    handle: "@justice_watch",
    avatarSeed: "JW",
    text: "Trump, Bondi, Patel, Johnson ‚Äî all of them know Trump cannot survive the full release of the Epstein files. The coverup started with Epstein‚Äôs sweetheart deal and it‚Äôs still going. People should be furious.",
    likes: 41,
    retweets: 9
  },
  {
    id: "p4",
    name: "Watcher",
    handle: "@watcher",
    avatarSeed: "WA",
    text: "Oh boy. This is either going to blow up or disappear like everything else tied to Epstein.",
    likes: 18,
    retweets: 2
  },
  {
    id: "p5",
    name: "Ella",
    handle: "@ella_az",
    avatarSeed: "EA",
    text: "Important question: If these emails were so damning, why are they surfacing now?",
    likes: 22,
    retweets: 1
  }
];

const morePosts = [
  {
    id: "p6",
    name: "SamR",
    handle: "@samr_talks",
    avatarSeed: "SR",
    text: "People forget Epstein had connections to basically every powerful circle ‚Äî politicians, tech people, finance, royalty. It‚Äôs weird how only one faction ever gets singled out.",
    likes: 16,
    retweets: 3
  },
  {
    id: "p7",
    name: "DylanZ",
    handle: "@dz_reads",
    avatarSeed: "DZ",
    text: "Everyone is assuming guilt or innocence based on their political team. The evidence should speak for itself, not party loyalty.",
    likes: 19,
    retweets: 1
  },
  {
    id: "p8",
    name: "MayaH",
    handle: "@mayah_ideas",
    avatarSeed: "MH",
    text: "Whether you like Trump or not, victims deserve transparency. Release *all* the files ‚Äî no redactions. The public deserves the truth.",
    likes: 27,
    retweets: 5
  },
  {
    id: "p9",
    name: "LeoC",
    handle: "@leoc_",
    avatarSeed: "LC",
    text: "Every time new Epstein documents drop, both parties selectively quote the parts that help them and quietly ignore the parts that don‚Äôt. It's all political spin now.",
    likes: 14,
    retweets: 0
  },
  {
    id: "p10",
    name: "Janelle",
    handle: "@janelle_d",
    avatarSeed: "JD",
    text: "Hard to trust anything when the justice system let Epstein operate for decades. It‚Äôs not just a Trump problem ‚Äî it‚Äôs a systemic failure.",
    likes: 20,
    retweets: 2
  },
  {
    id: "p11",
    name: "Avery",
    handle: "@averylane",
    avatarSeed: "AL",
    text: "What matters is whether these emails show coordination, awareness, or just name-dropping. Context matters. Headlines rarely include it.",
    likes: 24,
    retweets: 3
  },
  {
    id: "p12",
    name: "NoahT",
    handle: "@noahtech",
    avatarSeed: "NT",
    text: "I want to see the raw documents. No summaries, no political framing. Just release the PDFs.",
    likes: 12,
    retweets: 1
  }
];

const aiSummary = {
  id: "ai_summary",
  isAi: true,
  name: "AI Summary ü§ñ",
  avatarSeed: "AI",
  text: 'Senate unanimously votes to release more Epstein files after House approval‚Äîbill heading to Trump\'s desk. Many see this as another attempt to draw political attention, though Epstein‚Äôs network included figures across industries and parties. Critics point to selective outrage: why surface "damning" material only now? Transparency should apply evenly, without focusing on one faction.'
};


/* ---------------------------------------------------
   RANDOMIZATION + RENDER ENGINE
---------------------------------------------------- */

function shuffle(arr) {
  let a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function initials(seed) {
  const parts = String(seed).trim().split(/\s+/);
  return parts.length > 1 
    ? parts[0][0] + parts[1][0] 
    : String(seed).slice(0, 2).toUpperCase();
}

function seedToAvatarClass(seed) {
  let s = 0;
  for (let c of String(seed)) s += c.charCodeAt(0);
  return ["g1", "g2", "g3", "g4"][s % 4];
}

let appendedMore = false;
let likeCounts = {};
let retweetCounts = {};

const conversationEl = document.getElementById("conversation");

function renderInitial() {
  conversationEl.innerHTML = "";

  const first = initialPosts[0];
  const ai = createAiSummaryElement(aiSummary);
  const remaining = shuffle(initialPosts.slice(1));

  conversationEl.appendChild(createPostElement(first));
  conversationEl.appendChild(ai);
  remaining.forEach(p => conversationEl.appendChild(createPostElement(p)));
}

function createPostElement(p) {
  const wrapper = document.createElement("article");
  wrapper.className = "post fade-in";
  wrapper.id = `post-${p.id}`;

  const avatar = document.createElement("div");
  avatar.className = "avatar " + seedToAvatarClass(p.avatarSeed || p.name || p.id);
  avatar.textContent = initials(p.avatarSeed || p.name || p.id);

  const content = document.createElement("div");
  content.className = "content";

  const meta = document.createElement("div");
  meta.className = "meta";

  const name = document.createElement("span");
  name.className = "name";
  name.textContent = p.name;

  const handle = document.createElement("span");
  handle.className = "handle";
  handle.textContent = " " + p.handle;

  meta.append(name, handle);

  const text = document.createElement("div");
  text.className = "text";
  text.textContent = p.text;

  const actions = document.createElement("div");
  actions.className = "actions";

  const likeBtn = document.createElement("button");
  likeBtn.innerHTML = `‚ù§Ô∏è <span class="count">${p.likes || 0}</span>`;
  likeBtn.onclick = () => {
    likeCounts[p.id] = (likeCounts[p.id] ?? p.likes ?? 0) + 1;
    likeBtn.querySelector(".count").textContent = likeCounts[p.id];
    window.parent.postMessage({ type: "USER_LIKE", postId: p.id }, "*");
  };

  const rtBtn = document.createElement("button");
  rtBtn.innerHTML = `üîÅ <span class="count">${p.retweets || 0}</span>`;
  rtBtn.onclick = () => {
    retweetCounts[p.id] = (retweetCounts[p.id] ?? p.retweets ?? 0) + 1;
    rtBtn.querySelector(".count").textContent = retweetCounts[p.id];
    window.parent.postMessage({ type: "USER_RETWEET", postId: p.id }, "*");
  };

  actions.append(likeBtn, rtBtn);
  content.append(meta, text, actions);
  wrapper.append(avatar, content);

  addHoverTracking(wrapper, p.id);
  return wrapper;
}

function createAiSummaryElement(ai) {
  const el = document.createElement("div");
  el.className = "ai-summary fade-in";

  const avatar = document.createElement("div");
  avatar.className = "avatar g-ai";
  avatar.textContent = "ü§ñ";

  const content = document.createElement("div");
  content.className = "content";

  const meta = document.createElement("div");
  meta.className = "meta";

  const name = document.createElement("span");
  name.className = "name";
  name.textContent = ai.name;

  meta.appendChild(name);

  const text = document.createElement("div");
  text.className = "text";
  text.textContent = ai.text;

  content.append(meta, text);
  el.append(avatar, content);
  return el;
}

function addHoverTracking(el, postId) {
  let timer;
  el.addEventListener("mouseenter", () => {
    timer = setTimeout(() =>
      window.parent.postMessage({ type: "USER_HOVER_POST", postId }, "*"),
    2000);
  });
  el.addEventListener("mouseleave", () => clearTimeout(timer));
}

document.getElementById("showMore").addEventListener("click", e => {
  if (appendedMore) return;
  appendedMore = true;

  morePosts.forEach(p =>
    conversationEl.appendChild(createPostElement(p))
  );

  e.target.classList.add("fade-out");
  setTimeout(() => (e.target.style.display = "none"), 260);

  window.parent.postMessage({ type: "USER_SHOW_MORE_CLICKED" }, "*");
  sendHeightToParent();
});

document.getElementById("postComment").addEventListener("click", () => {
  const ta = document.getElementById("userComment");
  const txt = ta.value.trim();
  if (!txt) return alert("Please write something before posting.");

  const newPost = {
    id: "u" + Date.now(),
    name: "You",
    handle: "@you",
    avatarSeed: "YOU",
    text: txt,
    likes: 0,
    retweets: 0
  };

  conversationEl.appendChild(createPostElement(newPost));
  ta.value = "";

  window.parent.postMessage({ type: "USER_COMMENT", data: txt }, "*");
  sendHeightToParent();
});

let scrolledBottomSent = false;
window.addEventListener("scroll", () => {
  if (scrolledBottomSent) return;
  if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 6) {
    scrolledBottomSent = true;
    window.parent.postMessage({ type: "USER_SCROLLED_BOTTOM" }, "*");
  }
});

function sendHeightToParent() {
  if (window.parent !== window) {
    window.parent.postMessage(
      { type: "IFRAME_HEIGHT", height: document.body.scrollHeight },
      "*"
    );
  }
}

renderInitial();
sendHeightToParent();

const mo = new MutationObserver(sendHeightToParent);
mo.observe(conversationEl, { childList: true, subtree: true });
</script>

</body>
</html>
