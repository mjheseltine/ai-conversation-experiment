<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Conversation with AI Summary (Styled)</title>
<style>
  :root {
    --bg: #f6f7fb;
    --card: #fff;
    --muted: #6b7280;
    --accent: #1f6feb;
    --gold: #b45309;
    --radius: 12px;
    --shadow: 0 6px 18px rgba(35, 40, 50, 0.08);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body { background: var(--bg); margin: 24px; color: #111; }
  .container { max-width: 820px; margin: 0 auto; }
  .conversation { display: flex; flex-direction: column; gap: 12px; margin-bottom: 16px; }
  .post {
    background: var(--card);
    border-radius: var(--radius);
    padding: 14px;
    display: flex;
    gap: 12px;
    box-shadow: var(--shadow);
    align-items: flex-start;
  }
  .post.main-post { padding: 18px; font-size: 16px; background: #fff; }
  .avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    flex: 0 0 48px;
    display: grid;
    place-items: center;
    font-weight: 700;
    color: #0b61d6;
  }
  .content { flex: 1; }
  .meta { display: flex; gap: 8px; align-items: center; font-size: 13px; color: var(--muted); }
  .name { font-weight: 600; color: #0f1724; }
  .handle { color: var(--muted); }
  .time { color: var(--muted); }
  .text { margin-top: 8px; font-size: 15px; line-height: 1.45; color: #0f1724; }
  .actions { margin-top: 12px; display: flex; gap: 16px; color: var(--muted); font-size: 13px; }
  .actions span { display: flex; align-items: center; gap: 4px; cursor: pointer; transition: color 0.2s ease; }
  .actions .like-btn:hover { color: #e0245e; }
  .actions .retweet-btn:hover { color: #17bf63; }
  .actions .liked { color: #e0245e; }
  .actions .retweeted { color: #17bf63; }
  .actions .reply-btn { cursor: default; opacity: 0.6; }
  .ai-summary {
    background: #fffbea;
    border: 1px solid #facc15;
    border-radius: var(--radius);
    padding: 14px 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
    box-shadow: var(--shadow);
  }
  .ai-summary .avatar { background: #facc15; color: #92400e; }
  .ai-summary .meta { font-size: 13px; color: var(--gold); font-weight: 600; }
  .ai-summary .text { margin-top: 6px; font-size: 15px; line-height: 1.45; color: #1f2937; }
  .reply-box { margin-top: 12px; display: flex; gap: 10px; }
  textarea {
    flex: 1;
    min-height: 78px;
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #e6edf7;
    resize: vertical;
    font-size: 14px;
  }
  .submit { background: var(--accent); color: white; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; }
</style>
</head>
<body>
  <div class="container" role="main">
    <h2>Conversation Preview</h2>
    <div id="conversation" class="conversation"></div>

    <!-- AI summary card -->
    <div id="aiSummaryBox" class="ai-summary">
      <div class="avatar">AI</div>
      <div class="content">
        <div class="meta">AI Summary</div>
        <div class="text" id="summaryText">
          Rep. Hamadeh nails it‚ÄîDemocrats are holding the government hostage to push healthcare handouts for illegal immigrants.
          The "clean CR" Republicans offered funds operations without expanding benefits, but Dems insist on sneaking ACA loopholes that blur eligibility.
          Their bill pumps $662B into healthcare spending over a decade, including provisions that effectively subsidize coverage for migrants here unlawfully.
          This isn‚Äôt about ‚Äúclarifications‚Äù‚Äîit‚Äôs benefits creep by design.
          Shutdowns happen when D.C. prioritizes illegal entrants over citizens. Cut the waste, fund America First priorities, and watch how fast this ends.
        </div>
      </div>
    </div>

    <div style="margin-top:18px;">
      <label for="userComment" style="display:block;margin-bottom:8px;font-weight:600">Your comment</label>
      <div class="reply-box">
        <textarea id="userComment" placeholder="Write a reply..."></textarea>
        <button id="submitComment" class="submit">Post comment</button>
      </div>
    </div>
  </div>

<script>
const posts = [
  { id: "p1", avatarLabel: "AH", name: "Office of Congressman Abe Hamadeh", handle: "@RepHamadeh", time: "2h", text: "This government shutdown is entirely on the Democrats‚ÄîSenate Democrats and House Democrats egging them on. The Republicans have no reason to budge. This was a clean CR. The radical left is the one shutting down the government because they want to give healthcare to illegal immigrants. That's a non-starter.", likes: 50, retweets: 10 },
  { id: "p2", avatarLabel: "E", name: "Elaine", handle: "@Elaine", time: "1h", text: "Where does the 20 billion for Argentinian bail out come in? Republicans are a waste of government money.", likes: randomInt(2, 15), retweets: randomInt(0, 5) },
  { id: "p3", avatarLabel: "AA", name: "Angry Arizonans", handle: "@AngryAZ", time: "1h", text: "Hold the line. We don't negotiate with terrorists.", likes: randomInt(5, 20), retweets: randomInt(1, 5) },
  { id: "p4", avatarLabel: "DZ", name: "DennyZ", handle: "@dennyz", time: "30m", text: "‚ÄúClean CR‚Äù filled with the waste & fraud that @doge found, AND funding for USAID and PBS. That‚Äôs ‚Äúclean‚Äù? @SpeakerJohnson‚Äôs talking points. Sad.", likes: randomInt(3, 10), retweets: randomInt(0, 3) }
];

const avatarColors = ['#e6eefc','#fee2e2','#dcfce7','#fef9c3','#e0e7ff'];

function randomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
function initials(label) { const toks = label.trim().split(/\s+/); return toks.length>1?(toks[0][0]+toks[1][0]).toUpperCase():label.slice(0,2).toUpperCase(); }
function escapeHtml(text) { return String(text).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'); }

function renderConversation(containerId, postsArray){
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  postsArray.forEach((p,index)=>{
    const post = document.createElement("article");
    post.className = index===0?"post main-post":"post";
    post.setAttribute("data-post-id",p.id);
    const bgColor = avatarColors[index % avatarColors.length];
    post.innerHTML = `
      <div class="avatar" style="background:${bgColor}">${escapeHtml(initials(p.avatarLabel||p.name))}</div>
      <div class="content">
        <div class="meta"><div class="name">${escapeHtml(p.name)}</div><div class="handle">${escapeHtml(p.handle)}</div><div class="time">¬∑ ${escapeHtml(p.time)}</div></div>
        <div class="text">${escapeHtml(p.text)}</div>
        <div class="actions">
          <span class="like-btn" data-liked="false">‚ù§Ô∏è <span class="like-count">${p.likes||0}</span></span>
          <span class="retweet-btn" data-retweeted="false">üîÅ <span class="retweet-count">${p.retweets||0}</span></span>
          <span class="reply-btn">üí¨ Reply</span>
        </div>
      </div>`;
    container.appendChild(post);
  });

  // Move AI summary after first post
  const firstPost = container.querySelector(".post.main-post");
  if(firstPost){firstPost.insertAdjacentElement("afterend",document.getElementById("aiSummaryBox"));}

  // Like button
  container.querySelectorAll(".like-btn").forEach(btn=>{
    btn.addEventListener("click",()=>{
      const postEl = btn.closest(".post");
      const postId = postEl ? postEl.getAttribute("data-post-id") : null;
      const liked = btn.getAttribute("data-liked")==="true";
      const countSpan = btn.querySelector(".like-count");
      let count = parseInt(countSpan.textContent);
      count = liked? count-1 : count+1;
      countSpan.textContent = count;
      btn.setAttribute("data-liked",!liked);
      btn.classList.toggle("liked",!liked);

      // Notify Qualtrics
      if(window.parent!==window){window.parent.postMessage({type:"USER_LIKE",postId,count},"*");}

      // Send updated height
      sendHeightToParent();
    });
  });

  // Retweet button
  container.querySelectorAll(".retweet-btn").forEach(btn=>{
    btn.addEventListener("click",()=>{
      const postEl = btn.closest(".post");
      const postId = postEl ? postEl.getAttribute("data-post-id") : null;
      const retweeted = btn.getAttribute("data-retweeted")==="true";
      const countSpan = btn.querySelector(".retweet-count");
      let count = parseInt(countSpan.textContent);
      count = retweeted? count-1 : count+1;
      countSpan.textContent = count;
      btn.setAttribute("data-retweeted",!retweeted);
      btn.classList.toggle("retweeted",!retweeted);

      // Notify Qualtrics
      if(window.parent!==window){window.parent.postMessage({type:"USER_RETWEET",postId,count},"*");}

      // Send updated height
      sendHeightToParent();
    });
  });
}

renderConversation("conversation",posts);

// Capture user comment
document.getElementById("submitComment").addEventListener("click",()=>{
  const txt = document.getElementById("userComment").value.trim();
  if(!txt){alert("Please write something before posting."); return;}
  const newPost = { id:"u"+Date.now(), avatarLabel:"Y", name:"You", handle:"@you", time:"now", text:txt, likes:0, retweets:0 };
  posts.push(newPost);
  renderConversation("conversation",posts);
  document.getElementById("userComment").value="";

  // Send comment to Qualtrics
  if(window.parent!==window){window.parent.postMessage({type:"USER_COMMENT",data:txt},"*");}
});

// --- Auto-resize iframe ---
function sendHeightToParent(){
  if(window.parent!==window){
    const height = document.body.scrollHeight;
    window.parent.postMessage({type:"IFRAME_HEIGHT",height},"*");
  }
}

// Initial height send
sendHeightToParent();

// Observe conversation for changes (new posts) to update height
const observer = new MutationObserver(sendHeightToParent);
observer.observe(document.getElementById("conversation"),{childList:true,subtree:true});
</script>
</body>
</html>
